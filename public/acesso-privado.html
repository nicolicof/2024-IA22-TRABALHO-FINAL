<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VODVOD</title>
  <link rel="stylesheet" href="assets/style.css">
</head>

<body>
  <header>
    <div class="header header-x">
      <a href="acesso-privado.html">DarkHub</a>
      <div>
        <a href="./profile.html">Perfil</a>
      </div>
    </div>
  </header>
  <main>
    <div class="filmes-container">
    </div>
  </main>
</body>
<script>
  console.log(localStorage.getItem('token'))
  if (!localStorage.getItem('token')) {
    alert('Você não esta logado!')
    window.location = '/'
  }

  const filmesContainer = document.querySelector('.filmes-container')

  function formatDuration(minutes) {
    const horas = Math.floor(minutes / 60)
    const mins = minutes % 60
    const segundos = 0
    return `${String(horas).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(segundos).padStart(2, '0')}`
  }

  async function loadFilmes() {
    const url = '/user/movies'
    const method = 'GET'
    const headers = { 'Authorization': `${localStorage.getItem('token')}` }
    const response = await fetch(url, { method, headers })

    const dataResponse = await response.json()
    if (!response.ok) {
      console.log(response)
      console.log(dataResponse)
      return
    }

    dataResponse.forEach(filme => {
      const card = document.createElement('div')
      const imgBox = document.createElement('div')
      imgBox.className = 'img-filme'
      const filmeInfo = document.createElement('div')
      filmeInfo.className = 'filme-info'

      filmeInfo.append(
        Object.assign(document.createElement('p'), { innerText: filme.title }),
        Object.assign(document.createElement('span'), { innerText: formatDuration(filme.duration), className: 'filme-duration' }),
        Object.assign(document.createElement('span'), { innerText: `Úsuario: ${filme.inserted_by_name}`, className: 'filme-user' })
      )


      card.append(imgBox, filmeInfo)
      filmesContainer.appendChild(card)

      card.addEventListener('click', () => {
        localStorage.setItem('movieId', filme.id)
        localStorage.setItem('movieName', filme.title)
        localStorage.setItem('userMovie', filme.inserted_by_name)
        window.location.href = 'player.html'
      })
    })
  }

  loadFilmes()
</script>

</html>
